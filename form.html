<script>
  let selectedId = null; // Store the ID of the record being edited

  function insertData() {
    const name = document.getElementById('name').value;
    const address = document.getElementById('address').value;
    const phone = document.getElementById('phone').value;

    fetch('/insert', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, address, phone }),
    })
    .then(response => response.text())
    .then(result => {
      console.log(result);
      document.getElementById('result').innerText = result;
      resetForm();
      listData();
    })
    .catch(error => {
      console.error('Error:', error);
      document.getElementById('result').innerText = 'Error inserting data';
    });
  }

  function deleteData(id) {
    fetch('/delete', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id }),
    })
    .then(response => response.text())
    .then(result => {
      console.log(result);
      document.getElementById('result').innerText = result;
      listData();
    })
    .catch(error => {
      console.error('Error:', error);
      document.getElementById('result').innerText = 'Error deleting data';
    });
  }

  function editData(id, name, address, phone) {
    document.getElementById('name').value = name;
    document.getElementById('address').value = address;
    document.getElementById('phone').value = phone;
    selectedId = id; // Store the selected record ID
    document.getElementById('updateBtn').style.display = 'block';
    document.getElementById('insertBtn').style.display = 'none';
  }

  function updateData() {
    if (!selectedId) return;

    const name = document.getElementById('name').value;
    const address = document.getElementById('address').value;
    const phone = document.getElementById('phone').value;

    fetch('/update', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id: selectedId, name, address, phone }),
    })
    .then(response => response.text())
    .then(result => {
      console.log(result);
      document.getElementById('result').innerText = result;
      resetForm();
      listData();
    })
    .catch(error => {
      console.error('Error:', error);
      document.getElementById('result').innerText = 'Error updating data';
    });
  }

  function resetForm() {
    document.getElementById('dataForm').reset();
    selectedId = null;
    document.getElementById('updateBtn').style.display = 'none';
    document.getElementById('insertBtn').style.display = 'block';
  }

  function listData() {
    fetch('/list')
    .then(response => response.json())
    .then(data => {
      console.log(data);
      const listResultDiv = document.getElementById('listResult');
      listResultDiv.innerHTML = '<h2>All Form Details</h2>';

      if (data.length === 0) {
        listResultDiv.innerHTML += '<p>No data available.</p>';
      } else {
        data.forEach(row => {
          listResultDiv.innerHTML += `
            <div class="list-item">
              <div>
                <strong>Name:</strong> ${row.name}, 
                <strong>Address:</strong> ${row.address}, 
                <strong>Phone:</strong> ${row.phone}
              </div>
              <button type="button" onclick="editData(${row.id}, '${row.name}', '${row.address}', '${row.phone}')">Edit</button>
              <button type="button" onclick="deleteData(${row.id})">Delete</button>
            </div>`;
        });
      }
    })
    .catch(error => {
      console.error('Error:', error);
      document.getElementById('listResult').innerText = 'Error fetching data';
    });
  }
</script>
